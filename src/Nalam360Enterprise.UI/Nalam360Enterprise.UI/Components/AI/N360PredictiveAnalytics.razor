@using Nalam360Enterprise.UI.Core.Security
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Charts
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.ProgressBar
@inject IPermissionService PermissionService
@inject IAuditService AuditService

<div class="n360-predictive-analytics">
    @if (!HasPermission)
    {
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> You do not have permission to access Predictive Analytics.
        </div>
        return;
    }

    <div class="predictive-header">
        <h3>
            <i class="fas fa-chart-line"></i> Predictive Analytics
            @if (UseRealAI)
            {
                <span class="badge bg-success ms-2">ðŸ¤– Real AI</span>
            }
        </h3>
        <p class="predictive-subtitle">AI-powered predictions for patient outcomes and resource planning</p>
    </div>

    <SfTab CssClass="predictive-tabs">
        <TabItems>
            <TabItem>
                <ChildContent>
                    <TabHeader Text="Patient Prediction"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="prediction-panel">
                        <div class="input-section">
                            <div class="input-grid">
                                <div class="form-group">
                                    <label>Patient ID</label>
                                    <SfTextBox @bind-Value="@PatientId" Placeholder="Enter Patient ID" CssClass="prediction-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Age</label>
                                    <SfTextBox @bind-Value="@Age" Placeholder="Age" CssClass="prediction-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Admission Type</label>
                                    <SfTextBox @bind-Value="@AdmissionType" Placeholder="e.g., Emergency, Elective" CssClass="prediction-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Primary Diagnosis</label>
                                    <SfTextBox @bind-Value="@PrimaryDiagnosis" Placeholder="e.g., Heart Failure" CssClass="prediction-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Comorbidities</label>
                                    <SfTextBox @bind-Value="@Comorbidities" Placeholder="e.g., Diabetes, Hypertension" CssClass="prediction-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Vital Signs Score</label>
                                    <SfTextBox @bind-Value="@VitalScore" Placeholder="0-100" CssClass="prediction-input"></SfTextBox>
                                </div>
                            </div>

                            <SfButton CssClass="e-primary predict-btn" OnClick="GeneratePredictions" Disabled="@IsPredicting">
                                <i class="fas fa-brain"></i> @(IsPredicting ? "Analyzing..." : "Generate Predictions")
                            </SfButton>
                        </div>

                        @if (CurrentPrediction != null)
                        {
                            <div class="predictions-results">
                                <div class="prediction-cards">
                                    <div class="prediction-card readmission">
                                        <div class="card-icon">
                                            <i class="fas fa-redo-alt"></i>
                                        </div>
                                        <div class="card-content">
                                            <h4>Readmission Risk</h4>
                                            <div class="prediction-value risk-@CurrentPrediction.ReadmissionRisk.RiskLevel.ToLower()">
                                                @($"{CurrentPrediction.ReadmissionRisk.Probability:F1}%")
                                            </div>
                                            <div class="prediction-level">@CurrentPrediction.ReadmissionRisk.RiskLevel Risk</div>
                                            <div class="prediction-timeframe">30-day readmission</div>
                                            <SfProgressBar Type="ProgressType.Linear" 
                                                          Value="@CurrentPrediction.ReadmissionRisk.Probability" 
                                                          Height="8" 
                                                          TrackColor="#e9ecef"
                                                          ProgressColor="@GetRiskColor(CurrentPrediction.ReadmissionRisk.RiskLevel)"
                                                          ShowProgressValue="false">
                                            </SfProgressBar>
                                        </div>
                                    </div>

                                    <div class="prediction-card mortality">
                                        <div class="card-icon">
                                            <i class="fas fa-heartbeat"></i>
                                        </div>
                                        <div class="card-content">
                                            <h4>Mortality Risk</h4>
                                            <div class="prediction-value risk-@CurrentPrediction.MortalityRisk.RiskLevel.ToLower()">
                                                @($"{CurrentPrediction.MortalityRisk.Probability:F1}%")
                                            </div>
                                            <div class="prediction-level">@CurrentPrediction.MortalityRisk.RiskLevel Risk</div>
                                            <div class="prediction-timeframe">In-hospital mortality</div>
                                            <SfProgressBar Type="ProgressType.Linear" 
                                                          Value="@CurrentPrediction.MortalityRisk.Probability" 
                                                          Height="8" 
                                                          TrackColor="#e9ecef"
                                                          ProgressColor="@GetRiskColor(CurrentPrediction.MortalityRisk.RiskLevel)"
                                                          ShowProgressValue="false">
                                            </SfProgressBar>
                                        </div>
                                    </div>

                                    <div class="prediction-card los">
                                        <div class="card-icon">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                        <div class="card-content">
                                            <h4>Length of Stay</h4>
                                            <div class="prediction-value">@CurrentPrediction.LengthOfStay.PredictedDays</div>
                                            <div class="prediction-level">days (Â±@CurrentPrediction.LengthOfStay.ConfidenceInterval days)</div>
                                            <div class="prediction-timeframe">Expected duration</div>
                                            <div class="los-comparison">
                                                <span>Avg for diagnosis: @CurrentPrediction.LengthOfStay.AverageDays days</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="prediction-card complications">
                                        <div class="card-icon">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </div>
                                        <div class="card-content">
                                            <h4>Complication Risk</h4>
                                            <div class="prediction-value risk-@CurrentPrediction.ComplicationRisk.RiskLevel.ToLower()">
                                                @($"{CurrentPrediction.ComplicationRisk.Probability:F1}%")
                                            </div>
                                            <div class="prediction-level">@CurrentPrediction.ComplicationRisk.RiskLevel Risk</div>
                                            <div class="prediction-timeframe">Any complication</div>
                                            <SfProgressBar Type="ProgressType.Linear" 
                                                          Value="@CurrentPrediction.ComplicationRisk.Probability" 
                                                          Height="8" 
                                                          TrackColor="#e9ecef"
                                                          ProgressColor="@GetRiskColor(CurrentPrediction.ComplicationRisk.RiskLevel)"
                                                          ShowProgressValue="false">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="risk-factors-section">
                                    <h4><i class="fas fa-list-ul"></i> Top Risk Factors</h4>
                                    <div class="risk-factors-grid">
                                        @foreach (var factor in CurrentPrediction.RiskFactors)
                                        {
                                            <div class="risk-factor-item">
                                                <div class="factor-header">
                                                    <span class="factor-name">@factor.Factor</span>
                                                    <span class="factor-impact impact-@factor.Impact.ToLower()">@factor.Impact</span>
                                                </div>
                                                <div class="factor-contribution">
                                                    <div class="contribution-bar" style="width: @($"{factor.Contribution}%")"></div>
                                                    <span class="contribution-value">@($"{factor.Contribution:F1}%")</span>
                                                </div>
                                                <div class="factor-description">@factor.Description</div>
                                            </div>
                                        }
                                    </div>
                                </div>

                                <div class="recommendations-section">
                                    <h4><i class="fas fa-lightbulb"></i> Interventions to Reduce Risk</h4>
                                    <div class="interventions-list">
                                        @foreach (var intervention in CurrentPrediction.RecommendedInterventions)
                                        {
                                            <div class="intervention-card">
                                                <div class="intervention-header">
                                                    <span class="intervention-title">@intervention.Title</span>
                                                    <span class="intervention-impact">Expected reduction: @($"{intervention.ExpectedReduction}%")</span>
                                                </div>
                                                <div class="intervention-description">@intervention.Description</div>
                                                <div class="intervention-footer">
                                                    <span class="intervention-priority priority-@intervention.Priority.ToLower()">@intervention.Priority Priority</span>
                                                    <span class="intervention-evidence">Evidence: @intervention.EvidenceLevel</span>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Population Analytics"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="population-panel">
                        <div class="population-filters">
                            <SfButton CssClass="e-primary" OnClick="LoadPopulationData">
                                <i class="fas fa-sync-alt"></i> Load Population Data
                            </SfButton>
                        </div>

                        @if (PopulationMetrics != null)
                        {
                            <div class="population-metrics">
                                <div class="metric-card">
                                    <div class="metric-icon"><i class="fas fa-users"></i></div>
                                    <div class="metric-content">
                                        <div class="metric-label">Total Patients</div>
                                        <div class="metric-value">@PopulationMetrics.TotalPatients</div>
                                    </div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-icon high-risk"><i class="fas fa-exclamation-triangle"></i></div>
                                    <div class="metric-content">
                                        <div class="metric-label">High Risk</div>
                                        <div class="metric-value">@PopulationMetrics.HighRiskCount</div>
                                        <div class="metric-percent">@($"{PopulationMetrics.HighRiskPercent:F1}%")</div>
                                    </div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-icon"><i class="fas fa-bed"></i></div>
                                    <div class="metric-content">
                                        <div class="metric-label">Avg Length of Stay</div>
                                        <div class="metric-value">@($"{PopulationMetrics.AverageLOS:F1}") days</div>
                                    </div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-icon"><i class="fas fa-dollar-sign"></i></div>
                                    <div class="metric-content">
                                        <div class="metric-label">Predicted Costs</div>
                                        <div class="metric-value">$@PopulationMetrics.PredictedCosts</div>
                                    </div>
                                </div>
                            </div>

                            <div class="charts-section">
                                <div class="chart-container">
                                    <h4>Readmission Risk Distribution</h4>
                                    <SfChart>
                                        <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                        <ChartSeriesCollection>
                                            <ChartSeries DataSource="@PopulationMetrics.RiskDistribution" 
                                                        XName="Category" 
                                                        YName="Count" 
                                                        Type="ChartSeriesType.Column"
                                                        Fill="#3498db">
                                            </ChartSeries>
                                        </ChartSeriesCollection>
                                    </SfChart>
                                </div>

                                <div class="chart-container">
                                    <h4>Resource Utilization Forecast</h4>
                                    <SfChart>
                                        <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                        <ChartSeriesCollection>
                                            <ChartSeries DataSource="@PopulationMetrics.ResourceForecast" 
                                                        XName="Period" 
                                                        YName="Utilization" 
                                                        Type="ChartSeriesType.Line"
                                                        Fill="#e74c3c">
                                                <ChartMarker Visible="true"></ChartMarker>
                                            </ChartSeries>
                                        </ChartSeriesCollection>
                                    </SfChart>
                                </div>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Model Performance"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="model-performance-panel">
                        @if (ModelMetrics != null)
                        {
                            <div class="model-cards">
                                @foreach (var model in ModelMetrics)
                                {
                                    <div class="model-card">
                                        <div class="model-header">
                                            <h4>@model.ModelName</h4>
                                            <span class="model-status status-@model.Status.ToLower()">@model.Status</span>
                                        </div>
                                        <div class="model-metrics-grid">
                                            <div class="model-metric">
                                                <label>Accuracy</label>
                                                <div class="metric-with-bar">
                                                    <span class="metric-number">@($"{model.Accuracy:F1}%")</span>
                                                    <div class="mini-bar">
                                                        <div class="bar-fill" style="width: @($"{model.Accuracy}%")"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="model-metric">
                                                <label>Precision</label>
                                                <div class="metric-with-bar">
                                                    <span class="metric-number">@($"{model.Precision:F1}%")</span>
                                                    <div class="mini-bar">
                                                        <div class="bar-fill" style="width: @($"{model.Precision}%")"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="model-metric">
                                                <label>Recall</label>
                                                <div class="metric-with-bar">
                                                    <span class="metric-number">@($"{model.Recall:F1}%")</span>
                                                    <div class="mini-bar">
                                                        <div class="bar-fill" style="width: @($"{model.Recall}%")"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="model-metric">
                                                <label>F1 Score</label>
                                                <div class="metric-with-bar">
                                                    <span class="metric-number">@($"{model.F1Score:F1}%")</span>
                                                    <div class="mini-bar">
                                                        <div class="bar-fill" style="width: @($"{model.F1Score}%")"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="model-metric">
                                                <label>AUC-ROC</label>
                                                <div class="metric-with-bar">
                                                    <span class="metric-number">@($"{model.AUCROC:F3}")</span>
                                                    <div class="mini-bar">
                                                        <div class="bar-fill" style="width: @($"{model.AUCROC * 100}%")"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="model-info">
                                            <div class="info-row">
                                                <span class="info-label">Training Date:</span>
                                                <span>@model.LastTrainingDate.ToString("MMM dd, yyyy")</span>
                                            </div>
                                            <div class="info-row">
                                                <span class="info-label">Sample Size:</span>
                                                <span>@model.TrainingSampleSize.ToString("N0") patients</span>
                                            </div>
                                            <div class="info-row">
                                                <span class="info-label">Algorithm:</span>
                                                <span>@model.Algorithm</span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="High-Risk Patients"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="high-risk-panel">
                        @if (HighRiskPatients?.Any() == true)
                        {
                            <div class="risk-summary">
                                <div class="summary-stat critical">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <div>
                                        <div class="stat-value">@HighRiskPatients.Count(p => p.OverallRisk == "Critical")</div>
                                        <div class="stat-label">Critical Risk</div>
                                    </div>
                                </div>
                                <div class="summary-stat high">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div>
                                        <div class="stat-value">@HighRiskPatients.Count(p => p.OverallRisk == "High")</div>
                                        <div class="stat-label">High Risk</div>
                                    </div>
                                </div>
                            </div>

                            <SfGrid DataSource="@HighRiskPatients" AllowSorting="true" AllowFiltering="true" AllowPaging="true">
                                <GridPageSettings PageSize="10"></GridPageSettings>
                                <GridColumns>
                                    <GridColumn Field="@nameof(HighRiskPatient.PatientId)" HeaderText="Patient ID" Width="120"></GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.PatientName)" HeaderText="Name" Width="150"></GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.Diagnosis)" HeaderText="Diagnosis" Width="180"></GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.ReadmissionRisk)" HeaderText="Readmission %" Width="130">
                                        <Template>
                                            @{
                                                var patient = (context as HighRiskPatient)!;
                                                <span class="risk-badge risk-@GetRiskLevelFromPercent(patient.ReadmissionRisk).ToLower()">
                                                    @($"{patient.ReadmissionRisk:F1}%")
                                                </span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.MortalityRisk)" HeaderText="Mortality %" Width="130">
                                        <Template>
                                            @{
                                                var patient = (context as HighRiskPatient)!;
                                                <span class="risk-badge risk-@GetRiskLevelFromPercent(patient.MortalityRisk).ToLower()">
                                                    @($"{patient.MortalityRisk:F1}%")
                                                </span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.OverallRisk)" HeaderText="Overall Risk" Width="120">
                                        <Template>
                                            @{
                                                var patient = (context as HighRiskPatient)!;
                                                <span class="risk-level-badge risk-@patient.OverallRisk.ToLower()">@patient.OverallRisk</span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(HighRiskPatient.DaysInHospital)" HeaderText="LOS" Width="80"></GridColumn>
                                    <GridColumn HeaderText="Actions" Width="120">
                                        <Template>
                                            <SfButton CssClass="e-small e-info" IconCss="fas fa-eye">View</SfButton>
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                            </SfGrid>
                        }
                        else
                        {
                            <div class="empty-state">
                                <i class="fas fa-check-circle"></i>
                                <p>No high-risk patients identified at this time.</p>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>
        </TabItems>
    </SfTab>
</div>

<style>
    .n360-predictive-analytics {
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .predictive-header {
        margin-bottom: 30px;
    }

    .predictive-header h3 {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 8px;
    }

    .predictive-header h3 i {
        color: #9b59b6;
        margin-right: 10px;
    }

    .predictive-subtitle {
        color: #7f8c8d;
        font-size: 14px;
        margin: 0;
    }

    .predictive-tabs {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .prediction-panel {
        padding: 20px;
    }

    .input-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 13px;
    }

    .predict-btn {
        width: 100%;
        height: 44px;
        font-size: 15px;
    }

    .predictions-results {
        margin-top: 20px;
    }

    .prediction-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .prediction-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .prediction-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 24px;
    }

    .prediction-card.readmission .card-icon {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }

    .prediction-card.mortality .card-icon {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
    }

    .prediction-card.los .card-icon {
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
    }

    .prediction-card.complications .card-icon {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
    }

    .card-content h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .prediction-value {
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .prediction-value.risk-high, .prediction-value.risk-critical {
        color: #e74c3c;
    }

    .prediction-value.risk-moderate, .prediction-value.risk-medium {
        color: #f39c12;
    }

    .prediction-value.risk-low {
        color: #27ae60;
    }

    .prediction-level {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #2c3e50;
    }

    .prediction-timeframe {
        font-size: 12px;
        color: #95a5a6;
        margin-bottom: 15px;
    }

    .los-comparison {
        margin-top: 10px;
        padding: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        font-size: 12px;
        color: #7f8c8d;
    }

    .risk-factors-section, .recommendations-section {
        margin-bottom: 30px;
    }

    .risk-factors-section h4, .recommendations-section h4 {
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 18px;
    }

    .risk-factors-grid {
        display: grid;
        gap: 15px;
    }

    .risk-factor-item {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
    }

    .factor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .factor-name {
        font-weight: 600;
        color: #2c3e50;
    }

    .factor-impact {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .factor-impact.impact-high {
        background: #e74c3c;
        color: white;
    }

    .factor-impact.impact-moderate {
        background: #f39c12;
        color: white;
    }

    .factor-impact.impact-low {
        background: #3498db;
        color: white;
    }

    .factor-contribution {
        position: relative;
        height: 24px;
        background: #ecf0f1;
        border-radius: 4px;
        margin-bottom: 8px;
    }

    .contribution-bar {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2980b9);
        border-radius: 4px;
        transition: width 0.3s;
    }

    .contribution-value {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        font-weight: 600;
        color: #2c3e50;
    }

    .factor-description {
        font-size: 13px;
        color: #7f8c8d;
    }

    .interventions-list {
        display: grid;
        gap: 15px;
    }

    .intervention-card {
        background: white;
        border-left: 4px solid #3498db;
        border-radius: 4px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .intervention-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .intervention-title {
        font-weight: 600;
        color: #2c3e50;
        font-size: 15px;
    }

    .intervention-impact {
        color: #27ae60;
        font-weight: 600;
        font-size: 13px;
    }

    .intervention-description {
        margin-bottom: 10px;
        color: #555;
        line-height: 1.5;
    }

    .intervention-footer {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
    }

    .intervention-priority {
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 600;
    }

    .intervention-priority.priority-high {
        background: #e74c3c;
        color: white;
    }

    .intervention-priority.priority-medium {
        background: #f39c12;
        color: white;
    }

    .intervention-priority.priority-low {
        background: #3498db;
        color: white;
    }

    .intervention-evidence {
        color: #7f8c8d;
    }

    .population-panel, .model-performance-panel, .high-risk-panel {
        padding: 20px;
    }

    .population-filters {
        margin-bottom: 20px;
    }

    .population-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .metric-card.high-risk .metric-icon {
        background: rgba(231, 76, 60, 0.3);
    }

    .metric-icon {
        width: 50px;
        height: 50px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .metric-label {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 5px;
    }

    .metric-value {
        font-size: 28px;
        font-weight: bold;
    }

    .metric-percent {
        font-size: 14px;
        opacity: 0.9;
    }

    .charts-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
    }

    .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chart-container h4 {
        margin-bottom: 15px;
        color: #2c3e50;
    }

    .model-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
    }

    .model-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .model-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ecf0f1;
    }

    .model-header h4 {
        margin: 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .model-status {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .model-status.status-active {
        background: #27ae60;
        color: white;
    }

    .model-status.status-training {
        background: #f39c12;
        color: white;
    }

    .model-metrics-grid {
        display: grid;
        gap: 12px;
        margin-bottom: 15px;
    }

    .model-metric label {
        display: block;
        font-size: 12px;
        color: #7f8c8d;
        margin-bottom: 5px;
    }

    .metric-with-bar {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .metric-number {
        font-weight: 600;
        color: #2c3e50;
        min-width: 50px;
    }

    .mini-bar {
        flex: 1;
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
    }

    .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2980b9);
        transition: width 0.3s;
    }

    .model-info {
        padding-top: 15px;
        border-top: 1px solid #ecf0f1;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .info-label {
        color: #7f8c8d;
        font-weight: 600;
    }

    .risk-summary {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .summary-stat {
        flex: 1;
        padding: 20px;
        border-radius: 8px;
        color: white;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .summary-stat.critical {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .summary-stat.high {
        background: linear-gradient(135deg, #f39c12, #e67e22);
    }

    .summary-stat i {
        font-size: 32px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: bold;
    }

    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }

    .risk-badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .risk-badge.risk-high, .risk-badge.risk-critical {
        background: #e74c3c;
    }

    .risk-badge.risk-moderate, .risk-badge.risk-medium {
        background: #f39c12;
    }

    .risk-badge.risk-low {
        background: #27ae60;
    }

    .risk-level-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        color: white;
    }

    .risk-level-badge.risk-critical {
        background: #e74c3c;
    }

    .risk-level-badge.risk-high {
        background: #f39c12;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #95a5a6;
    }

    .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .alert-warning {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
    }
</style>
