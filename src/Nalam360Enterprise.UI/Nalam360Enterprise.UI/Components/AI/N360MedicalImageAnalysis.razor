@using Nalam360Enterprise.UI.Core.Security
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.ProgressBar
@inject IPermissionService PermissionService
@inject IAuditService AuditService

<div class="n360-medical-image-analysis">
    @if (!HasPermission)
    {
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> You do not have permission to access Medical Image Analysis.
        </div>
        return;
    }

    <div class="image-analysis-header">
        <h3>
            <i class="fas fa-x-ray"></i> Medical Image Analysis
            @if (UseRealAI)
            {
                <span class="badge bg-success ms-2">ðŸ¤– Real AI</span>
            }
        </h3>
        <p class="image-subtitle">AI-powered imaging diagnostics with automated detection and measurement</p>
    </div>

    <SfTab CssClass="image-tabs">
        <TabItems>
            <TabItem>
                <ChildContent>
                    <TabHeader Text="Image Upload & Analysis"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="upload-panel">
                        <div class="upload-section">
                            <div class="upload-controls">
                                <div class="form-group">
                                    <label>Study ID</label>
                                    <SfTextBox @bind-Value="@StudyId" Placeholder="Enter Study ID" CssClass="image-input"></SfTextBox>
                                </div>

                                <div class="form-group">
                                    <label>Modality</label>
                                    <SfDropDownList @bind-Value="@SelectedModality" DataSource="@Modalities" Placeholder="Select Modality" CssClass="image-input">
                                    </SfDropDownList>
                                </div>

                                <div class="form-group">
                                    <label>Body Part</label>
                                    <SfDropDownList @bind-Value="@SelectedBodyPart" DataSource="@BodyParts" Placeholder="Select Body Part" CssClass="image-input">
                                    </SfDropDownList>
                                </div>

                                <div class="form-group full-width">
                                    <label>Clinical History</label>
                                    <SfTextBox @bind-Value="@ClinicalHistory" Multiline="true" Placeholder="Brief clinical context..." CssClass="image-textarea"></SfTextBox>
                                </div>
                            </div>

                            <div class="upload-area">
                                <div class="upload-dropzone">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <h4>Upload Medical Images</h4>
                                    <p>Drag & drop DICOM, PNG, or JPEG files</p>
                                    <p class="upload-formats">Supported: DICOM (.dcm), PNG (.png), JPEG (.jpg)</p>
                                    <SfButton CssClass="e-primary upload-btn">
                                        <i class="fas fa-folder-open"></i> Browse Files
                                    </SfButton>
                                </div>
                            </div>

                            <SfButton CssClass="e-success analyze-btn" OnClick="AnalyzeImage" Disabled="@IsAnalyzing">
                                <i class="fas fa-brain"></i> @(IsAnalyzing ? "Analyzing Image..." : "Start AI Analysis")
                            </SfButton>
                        </div>

                        @if (CurrentAnalysis != null)
                        {
                            <div class="analysis-results">
                                <div class="image-viewer">
                                    <div class="viewer-header">
                                        <h4><i class="fas fa-image"></i> Image Viewer</h4>
                                        <div class="viewer-tools">
                                            <SfButton CssClass="e-small" IconCss="fas fa-search-plus">Zoom In</SfButton>
                                            <SfButton CssClass="e-small" IconCss="fas fa-search-minus">Zoom Out</SfButton>
                                            <SfButton CssClass="e-small" IconCss="fas fa-undo">Reset</SfButton>
                                            <SfButton CssClass="e-small" IconCss="fas fa-ruler">Measure</SfButton>
                                        </div>
                                    </div>
                                    <div class="image-display">
                                        <div class="placeholder-image">
                                            <i class="fas fa-x-ray"></i>
                                            <p>@SelectedModality Image</p>
                                            <p class="image-info">@SelectedBodyPart - Study: @StudyId</p>
                                        </div>
                                        @foreach (var finding in CurrentAnalysis.DetectedFindings)
                                        {
                                            <div class="detection-overlay" style="top: @(finding.BoundingBox.Y)%; left: @(finding.BoundingBox.X)%; width: @(finding.BoundingBox.Width)%; height: @(finding.BoundingBox.Height)%;">
                                                <span class="detection-label">@finding.FindingType (@($"{finding.Confidence:F0}%"))</span>
                                            </div>
                                        }
                                    </div>
                                </div>

                                <div class="findings-panel">
                                    <h4><i class="fas fa-search"></i> AI-Detected Findings</h4>
                                    
                                    <div class="analysis-summary">
                                        <div class="summary-item critical">
                                            <i class="fas fa-exclamation-circle"></i>
                                            <div>
                                                <span class="summary-label">Critical</span>
                                                <span class="summary-count">@CurrentAnalysis.DetectedFindings.Count(f => f.Severity == "Critical")</span>
                                            </div>
                                        </div>
                                        <div class="summary-item moderate">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <div>
                                                <span class="summary-label">Moderate</span>
                                                <span class="summary-count">@CurrentAnalysis.DetectedFindings.Count(f => f.Severity == "Moderate")</span>
                                            </div>
                                        </div>
                                        <div class="summary-item normal">
                                            <i class="fas fa-check-circle"></i>
                                            <div>
                                                <span class="summary-label">Normal</span>
                                                <span class="summary-count">@CurrentAnalysis.DetectedFindings.Count(f => f.Severity == "Normal")</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="findings-list">
                                        @foreach (var finding in CurrentAnalysis.DetectedFindings.OrderByDescending(f => f.Priority))
                                        {
                                            <div class="finding-card severity-@finding.Severity.ToLower()">
                                                <div class="finding-header">
                                                    <div class="finding-title">
                                                        <span class="finding-type">@finding.FindingType</span>
                                                        <span class="finding-location">@finding.Location</span>
                                                    </div>
                                                    <span class="severity-badge severity-@finding.Severity.ToLower()">@finding.Severity</span>
                                                </div>
                                                <div class="finding-description">@finding.Description</div>
                                                <div class="finding-measurements">
                                                    @if (!string.IsNullOrEmpty(finding.Size))
                                                    {
                                                        <span><i class="fas fa-ruler-combined"></i> Size: @finding.Size</span>
                                                    }
                                                    @if (!string.IsNullOrEmpty(finding.Volume))
                                                    {
                                                        <span><i class="fas fa-cube"></i> Volume: @finding.Volume</span>
                                                    }
                                                </div>
                                                <div class="finding-footer">
                                                    <span class="confidence-badge">
                                                        <SfProgressBar Type="ProgressType.Linear" 
                                                                      Value="@finding.Confidence" 
                                                                      Height="6" 
                                                                      Width="80"
                                                                      TrackColor="#e9ecef"
                                                                      ProgressColor="#3498db"
                                                                      ShowProgressValue="false">
                                                        </SfProgressBar>
                                                        @($"{finding.Confidence:F1}%") confidence
                                                    </span>
                                                    <SfButton CssClass="e-small e-info" IconCss="fas fa-info-circle">Details</SfButton>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="recommendations-section">
                                <h4><i class="fas fa-stethoscope"></i> Clinical Recommendations</h4>
                                <div class="recommendations-grid">
                                    @foreach (var rec in CurrentAnalysis.Recommendations)
                                    {
                                        <div class="recommendation-card priority-@rec.Priority.ToLower()">
                                            <div class="rec-icon">
                                                <i class="@rec.IconClass"></i>
                                            </div>
                                            <div class="rec-content">
                                                <h5>@rec.Title</h5>
                                                <p>@rec.Description</p>
                                                <span class="rec-priority">@rec.Priority Priority</span>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="report-section">
                                <h4><i class="fas fa-file-medical-alt"></i> AI-Generated Report</h4>
                                <div class="report-content">
                                    <div class="report-header-info">
                                        <div><strong>Study ID:</strong> @StudyId</div>
                                        <div><strong>Modality:</strong> @SelectedModality</div>
                                        <div><strong>Date:</strong> @DateTime.Now.ToString("MMM dd, yyyy HH:mm")</div>
                                    </div>
                                    <div class="report-section-content">
                                        <h5>FINDINGS:</h5>
                                        <p>@CurrentAnalysis.ReportSummary</p>
                                    </div>
                                    <div class="report-section-content">
                                        <h5>IMPRESSION:</h5>
                                        <p>@CurrentAnalysis.Impression</p>
                                    </div>
                                    <div class="report-actions">
                                        <SfButton CssClass="e-primary" IconCss="fas fa-download">Export Report</SfButton>
                                        <SfButton CssClass="e-outline" IconCss="fas fa-share">Share</SfButton>
                                        <SfButton CssClass="e-outline" IconCss="fas fa-print">Print</SfButton>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Study History"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="history-panel">
                        @if (StudyHistory?.Any() == true)
                        {
                            <SfGrid DataSource="@StudyHistory" AllowSorting="true" AllowFiltering="true" AllowPaging="true">
                                <GridPageSettings PageSize="15"></GridPageSettings>
                                <GridColumns>
                                    <GridColumn Field="@nameof(StudyRecord.StudyId)" HeaderText="Study ID" Width="120"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.PatientName)" HeaderText="Patient" Width="150"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.Modality)" HeaderText="Modality" Width="100"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.BodyPart)" HeaderText="Body Part" Width="120"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.StudyDate)" HeaderText="Date" Width="130" Format="MMM dd, yyyy"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.FindingsCount)" HeaderText="Findings" Width="90"></GridColumn>
                                    <GridColumn Field="@nameof(StudyRecord.Status)" HeaderText="Status" Width="110">
                                        <Template>
                                            @{
                                                var study = (context as StudyRecord)!;
                                                <span class="status-badge status-@study.Status.ToLower()">@study.Status</span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn HeaderText="Actions" Width="150">
                                        <Template>
                                            <SfButton CssClass="e-small e-info" IconCss="fas fa-eye">View</SfButton>
                                            <SfButton CssClass="e-small e-primary" IconCss="fas fa-download">Export</SfButton>
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                            </SfGrid>
                        }
                        else
                        {
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <p>No study history available. Upload and analyze images to see history.</p>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="AI Models"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="models-panel">
                        @if (AIModels?.Any() == true)
                        {
                            <div class="models-grid">
                                @foreach (var model in AIModels)
                                {
                                    <div class="model-card">
                                        <div class="model-header">
                                            <h4>@model.ModelName</h4>
                                            <span class="model-status status-@model.Status.ToLower()">@model.Status</span>
                                        </div>
                                        <div class="model-info-grid">
                                            <div class="model-info-item">
                                                <label>Modality</label>
                                                <span>@model.Modality</span>
                                            </div>
                                            <div class="model-info-item">
                                                <label>Target</label>
                                                <span>@model.Target</span>
                                            </div>
                                            <div class="model-info-item">
                                                <label>Accuracy</label>
                                                <span class="metric-value">@($"{model.Accuracy:F1}%")</span>
                                            </div>
                                            <div class="model-info-item">
                                                <label>Sensitivity</label>
                                                <span class="metric-value">@($"{model.Sensitivity:F1}%")</span>
                                            </div>
                                            <div class="model-info-item">
                                                <label>Specificity</label>
                                                <span class="metric-value">@($"{model.Specificity:F1}%")</span>
                                            </div>
                                            <div class="model-info-item">
                                                <label>AUC</label>
                                                <span class="metric-value">@($"{model.AUC:F3}")</span>
                                            </div>
                                        </div>
                                        <div class="model-details">
                                            <p><strong>Training:</strong> @model.TrainingSamples.ToString("N0") images</p>
                                            <p><strong>Updated:</strong> @model.LastUpdated.ToString("MMM dd, yyyy")</p>
                                            <p><strong>Version:</strong> @model.Version</p>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Statistics"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="statistics-panel">
                        @if (Statistics != null)
                        {
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-images"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-value">@Statistics.TotalStudies.ToString("N0")</div>
                                        <div class="stat-label">Total Studies</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-search"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-value">@Statistics.TotalFindings.ToString("N0")</div>
                                        <div class="stat-label">AI Findings</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-percentage"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-value">@($"{Statistics.AverageConfidence:F1}%")</div>
                                        <div class="stat-label">Avg Confidence</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-value">@($"{Statistics.AverageProcessingTime:F1}s")</div>
                                        <div class="stat-label">Avg Analysis Time</div>
                                    </div>
                                </div>
                            </div>

                            <div class="charts-row">
                                <div class="chart-card">
                                    <h4>Findings by Severity</h4>
                                    <div class="severity-breakdown">
                                        <div class="severity-item critical">
                                            <div class="severity-bar" style="width: @($"{Statistics.CriticalPercentage}%")"></div>
                                            <span>Critical: @Statistics.CriticalCount (@($"{Statistics.CriticalPercentage:F0}%"))</span>
                                        </div>
                                        <div class="severity-item moderate">
                                            <div class="severity-bar" style="width: @($"{Statistics.ModeratePercentage}%")"></div>
                                            <span>Moderate: @Statistics.ModerateCount (@($"{Statistics.ModeratePercentage:F0}%"))</span>
                                        </div>
                                        <div class="severity-item normal">
                                            <div class="severity-bar" style="width: @($"{Statistics.NormalPercentage}%")"></div>
                                            <span>Normal: @Statistics.NormalCount (@($"{Statistics.NormalPercentage:F0}%"))</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="chart-card">
                                    <h4>Studies by Modality</h4>
                                    <div class="modality-breakdown">
                                        @foreach (var modality in Statistics.ModalityBreakdown)
                                        {
                                            <div class="modality-item">
                                                <span class="modality-name">@modality.Key</span>
                                                <div class="modality-progress">
                                                    <div class="progress-fill" style="width: @($"{modality.Value}%")"></div>
                                                </div>
                                                <span class="modality-value">@modality.Value%</span>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </ContentTemplate>
            </TabItem>
        </TabItems>
    </SfTab>
</div>

<style>
    .n360-medical-image-analysis {
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .image-analysis-header {
        margin-bottom: 30px;
    }

    .image-analysis-header h3 {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 8px;
    }

    .image-analysis-header h3 i {
        color: #16a085;
        margin-right: 10px;
    }

    .image-subtitle {
        color: #7f8c8d;
        font-size: 14px;
        margin: 0;
    }

    .image-tabs {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .upload-panel {
        padding: 20px;
    }

    .upload-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .upload-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .upload-controls .full-width {
        grid-column: 1 / -1;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 13px;
    }

    .image-textarea {
        min-height: 80px;
    }

    .upload-area {
        margin-bottom: 20px;
    }

    .upload-dropzone {
        border: 3px dashed #bdc3c7;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        background: white;
        transition: all 0.3s;
    }

    .upload-dropzone:hover {
        border-color: #3498db;
        background: #f8f9fa;
    }

    .upload-dropzone i {
        font-size: 64px;
        color: #3498db;
        margin-bottom: 15px;
    }

    .upload-dropzone h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
    }

    .upload-dropzone p {
        margin: 5px 0;
        color: #7f8c8d;
    }

    .upload-formats {
        font-size: 12px;
        color: #95a5a6;
    }

    .upload-btn {
        margin-top: 15px;
    }

    .analyze-btn {
        width: 100%;
        height: 44px;
        font-size: 15px;
    }

    .analysis-results {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .image-viewer {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        overflow: hidden;
    }

    .viewer-header {
        background: #34495e;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .viewer-header h4 {
        margin: 0;
        font-size: 16px;
    }

    .viewer-tools {
        display: flex;
        gap: 8px;
    }

    .image-display {
        position: relative;
        background: #2c3e50;
        height: 500px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .placeholder-image {
        text-align: center;
        color: #95a5a6;
    }

    .placeholder-image i {
        font-size: 120px;
        margin-bottom: 20px;
    }

    .placeholder-image p {
        margin: 5px 0;
        font-size: 18px;
    }

    .image-info {
        font-size: 14px !important;
    }

    .detection-overlay {
        position: absolute;
        border: 3px solid #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        pointer-events: none;
    }

    .detection-label {
        position: absolute;
        top: -25px;
        left: 0;
        background: #e74c3c;
        color: white;
        padding: 4px 8px;
        font-size: 12px;
        font-weight: 600;
        border-radius: 4px;
        white-space: nowrap;
    }

    .findings-panel {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        padding: 20px;
        max-height: 560px;
        overflow-y: auto;
    }

    .findings-panel h4 {
        margin: 0 0 15px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .analysis-summary {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }

    .summary-item {
        flex: 1;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
        color: white;
    }

    .summary-item.critical {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .summary-item.moderate {
        background: linear-gradient(135deg, #f39c12, #e67e22);
    }

    .summary-item.normal {
        background: linear-gradient(135deg, #27ae60, #229954);
    }

    .summary-item i {
        font-size: 28px;
    }

    .summary-label {
        display: block;
        font-size: 12px;
        opacity: 0.9;
    }

    .summary-count {
        display: block;
        font-size: 24px;
        font-weight: bold;
    }

    .findings-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .finding-card {
        border: 2px solid;
        border-radius: 8px;
        padding: 15px;
        background: white;
    }

    .finding-card.severity-critical {
        border-color: #e74c3c;
        background: #ffebee;
    }

    .finding-card.severity-moderate {
        border-color: #f39c12;
        background: #fff8e1;
    }

    .finding-card.severity-normal {
        border-color: #27ae60;
        background: #eafaf1;
    }

    .finding-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
    }

    .finding-title {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .finding-type {
        font-weight: 600;
        font-size: 15px;
        color: #2c3e50;
    }

    .finding-location {
        font-size: 13px;
        color: #7f8c8d;
    }

    .severity-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .severity-badge.severity-critical {
        background: #e74c3c;
    }

    .severity-badge.severity-moderate {
        background: #f39c12;
    }

    .severity-badge.severity-normal {
        background: #27ae60;
    }

    .finding-description {
        margin-bottom: 10px;
        color: #555;
        line-height: 1.5;
        font-size: 14px;
    }

    .finding-measurements {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        font-size: 13px;
        color: #7f8c8d;
    }

    .finding-measurements i {
        margin-right: 5px;
    }

    .finding-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 10px;
        border-top: 1px solid rgba(0,0,0,0.1);
    }

    .confidence-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 600;
        color: #3498db;
    }

    .recommendations-section, .report-section {
        margin-bottom: 30px;
    }

    .recommendations-section h4, .report-section h4 {
        margin-bottom: 20px;
        color: #2c3e50;
        font-size: 18px;
    }

    .recommendations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
    }

    .recommendation-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        padding: 20px;
        display: flex;
        gap: 15px;
        transition: transform 0.2s;
    }

    .recommendation-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .recommendation-card.priority-high {
        border-color: #e74c3c;
    }

    .recommendation-card.priority-medium {
        border-color: #f39c12;
    }

    .recommendation-card.priority-low {
        border-color: #3498db;
    }

    .rec-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
    }

    .priority-high .rec-icon {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
    }

    .priority-medium .rec-icon {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
    }

    .priority-low .rec-icon {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }

    .rec-content h5 {
        margin: 0 0 8px 0;
        color: #2c3e50;
        font-size: 15px;
    }

    .rec-content p {
        margin: 0 0 10px 0;
        color: #7f8c8d;
        font-size: 13px;
        line-height: 1.4;
    }

    .rec-priority {
        font-size: 12px;
        font-weight: 600;
        color: #95a5a6;
    }

    .report-content {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        padding: 25px;
    }

    .report-header-info {
        display: flex;
        gap: 30px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ecf0f1;
        font-size: 14px;
    }

    .report-section-content {
        margin-bottom: 20px;
    }

    .report-section-content h5 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .report-section-content p {
        margin: 0;
        color: #555;
        line-height: 1.6;
    }

    .report-actions {
        display: flex;
        gap: 10px;
        padding-top: 20px;
        border-top: 2px solid #ecf0f1;
    }

    .history-panel, .models-panel, .statistics-panel {
        padding: 20px;
    }

    .models-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
    }

    .model-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .model-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ecf0f1;
    }

    .model-header h4 {
        margin: 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .model-status {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .model-status.status-active {
        background: #27ae60;
        color: white;
    }

    .model-info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 15px;
    }

    .model-info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .model-info-item label {
        font-size: 12px;
        color: #7f8c8d;
        font-weight: 600;
    }

    .model-info-item span {
        font-size: 14px;
        color: #2c3e50;
    }

    .metric-value {
        font-weight: 600;
        color: #3498db !important;
    }

    .model-details {
        padding-top: 15px;
        border-top: 1px solid #ecf0f1;
        font-size: 13px;
        color: #7f8c8d;
    }

    .model-details p {
        margin: 5px 0;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }

    .charts-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
    }

    .chart-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .chart-card h4 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .severity-breakdown, .modality-breakdown {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .severity-item, .modality-item {
        position: relative;
    }

    .severity-item span, .modality-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        color: #2c3e50;
    }

    .severity-bar {
        height: 30px;
        border-radius: 4px;
        margin-bottom: 5px;
        transition: width 0.5s;
    }

    .severity-item.critical .severity-bar {
        background: linear-gradient(90deg, #e74c3c, #c0392b);
    }

    .severity-item.moderate .severity-bar {
        background: linear-gradient(90deg, #f39c12, #e67e22);
    }

    .severity-item.normal .severity-bar {
        background: linear-gradient(90deg, #27ae60, #229954);
    }

    .modality-name {
        min-width: 80px;
        font-weight: 600;
    }

    .modality-progress {
        flex: 1;
        height: 24px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2980b9);
        transition: width 0.5s;
    }

    .modality-value {
        min-width: 50px;
        text-align: right;
        font-weight: 600;
        color: #3498db;
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .status-badge.status-analyzed {
        background: #27ae60;
    }

    .status-badge.status-pending {
        background: #f39c12;
    }

    .status-badge.status-reviewed {
        background: #3498db;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #95a5a6;
    }

    .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .alert-warning {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
    }
</style>
