@using Nalam360Enterprise.UI.Core.Security
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.Charts
@using Syncfusion.Blazor.ProgressBar
@inject IPermissionService PermissionService
@inject IAuditService AuditService

<div class="n360-revenue-cycle">
    @if (!HasPermission)
    {
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> You do not have permission to access Revenue Cycle Management.
        </div>
        return;
    }

    <div class="revenue-header">
        <h3>
            <i class="fas fa-dollar-sign"></i> AI-Powered Revenue Cycle Management
            @if (UseRealAI)
            {
                <span class="badge bg-success ms-2">ðŸ¤– Real AI</span>
            }
        </h3>
        <p class="revenue-subtitle">Intelligent claims processing, denial prevention, and financial optimization</p>
    </div>

    <SfTab CssClass="revenue-tabs">
        <TabItems>
            <TabItem>
                <ChildContent>
                    <TabHeader Text="Financial Dashboard"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="dashboard-panel">
                        <div class="financial-overview">
                            <h4><i class="fas fa-chart-line"></i> Revenue Performance Metrics</h4>
                            <div class="metrics-grid">
                                <div class="metric-card revenue">
                                    <div class="metric-icon">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Monthly Revenue</div>
                                        <div class="metric-value">$@($"{FinancialMetrics.MonthlyRevenue:N0}")</div>
                                        <div class="metric-trend trend-up">
                                            <i class="fas fa-arrow-up"></i> 7.2% vs last month
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@((double)FinancialMetrics.MonthlyRevenue / 25000000 * 100)" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#27ae60">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card collection">
                                    <div class="metric-icon">
                                        <i class="fas fa-hand-holding-usd"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Collection Rate</div>
                                        <div class="metric-value">@($"{FinancialMetrics.CollectionRate:F1}%")</div>
                                        <div class="metric-trend trend-up">
                                            <i class="fas fa-arrow-up"></i> 2.1% improvement
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@FinancialMetrics.CollectionRate" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#3498db">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card ar">
                                    <div class="metric-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Days in AR</div>
                                        <div class="metric-value">@FinancialMetrics.DaysInAR days</div>
                                        <div class="metric-trend trend-down">
                                            <i class="fas fa-arrow-down"></i> 8.5% reduction
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@((90 - FinancialMetrics.DaysInAR) / 90 * 100)" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#f39c12">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card denial">
                                    <div class="metric-icon">
                                        <i class="fas fa-ban"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Denial Rate</div>
                                        <div class="metric-value">@($"{FinancialMetrics.DenialRate:F1}%")</div>
                                        <div class="metric-trend trend-down">
                                            <i class="fas fa-arrow-down"></i> 15% decrease
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@FinancialMetrics.DenialRate" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#e74c3c">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card clean-claim">
                                    <div class="metric-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Clean Claim Rate</div>
                                        <div class="metric-value">@($"{FinancialMetrics.CleanClaimRate:F1}%")</div>
                                        <div class="metric-trend trend-up">
                                            <i class="fas fa-arrow-up"></i> 4.3% improvement
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@FinancialMetrics.CleanClaimRate" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#9b59b6">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card net-collection">
                                    <div class="metric-icon">
                                        <i class="fas fa-coins"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-label">Net Collection %</div>
                                        <div class="metric-value">@($"{FinancialMetrics.NetCollectionRate:F1}%")</div>
                                        <div class="metric-trend trend-up">
                                            <i class="fas fa-arrow-up"></i> Above benchmark
                                        </div>
                                        <div class="metric-progress">
                                            <SfProgressBar Type="ProgressType.Linear" Value="@FinancialMetrics.NetCollectionRate" 
                                                         Height="6" TrackColor="#e0e0e0" ProgressColor="#16a085">
                                            </SfProgressBar>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="revenue-charts">
                            <div class="chart-container">
                                <h5><i class="fas fa-chart-area"></i> Revenue Trend (Last 12 Months)</h5>
                                <SfChart>
                                    <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                    <ChartPrimaryYAxis Title="Revenue ($)"></ChartPrimaryYAxis>
                                    <ChartSeriesCollection>
                                        <ChartSeries DataSource="@RevenueTrend" XName="Month" YName="Revenue" 
                                                   Type="ChartSeriesType.Area" Fill="#3498db" Opacity="0.6">
                                            <ChartMarker Visible="true"></ChartMarker>
                                        </ChartSeries>
                                    </ChartSeriesCollection>
                                </SfChart>
                            </div>

                            <div class="chart-container">
                                <h5><i class="fas fa-chart-pie"></i> Payer Mix Distribution</h5>
                                <SfAccumulationChart>
                                    <AccumulationChartSeriesCollection>
                                        <AccumulationChartSeries DataSource="@PayerMix"
                                                                XName="Payer"
                                                                YName="Percentage"
                                                                Type="AccumulationType.Pie">
                                            <AccumulationDataLabelSettings Visible="true" Name="Payer" Position="AccumulationLabelPosition.Outside">
                                            </AccumulationDataLabelSettings>
                                        </AccumulationChartSeries>
                                    </AccumulationChartSeriesCollection>
                                </SfAccumulationChart>
                            </div>
                        </div>
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Claims Processing"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="claims-panel">
                        <div class="claims-overview">
                            <h4><i class="fas fa-file-invoice-dollar"></i> AI-Powered Claims Management</h4>
                            <div class="claims-stats">
                                <div class="stat-card">
                                    <i class="fas fa-paper-plane"></i>
                                    <div>
                                        <div class="stat-value">@ClaimsStats.TotalSubmitted</div>
                                        <div class="stat-label">Claims Submitted Today</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-check-double"></i>
                                    <div>
                                        <div class="stat-value">@ClaimsStats.AutoApproved</div>
                                        <div class="stat-label">Auto-Approved by AI</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <div>
                                        <div class="stat-value">@ClaimsStats.FlaggedForReview</div>
                                        <div class="stat-label">Flagged for Review</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <i class="fas fa-stopwatch"></i>
                                    <div>
                                        <div class="stat-value">@ClaimsStats.AvgProcessingTime min</div>
                                        <div class="stat-label">Avg Processing Time</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="claims-queue">
                            <h5><i class="fas fa-list"></i> Claims Queue - AI Processing Status</h5>
                            <SfGrid DataSource="@ClaimsQueue" AllowSorting="true" AllowPaging="true" PageSize="10">
                                <GridColumns>
                                    <GridColumn Field="@nameof(Claim.ClaimId)" HeaderText="Claim ID" Width="130"></GridColumn>
                                    <GridColumn Field="@nameof(Claim.PatientName)" HeaderText="Patient" Width="150"></GridColumn>
                                    <GridColumn Field="@nameof(Claim.Payer)" HeaderText="Payer" Width="140"></GridColumn>
                                    <GridColumn Field="@nameof(Claim.Amount)" HeaderText="Amount" Width="120" Format="C0"></GridColumn>
                                    <GridColumn Field="@nameof(Claim.ServiceDate)" HeaderText="Service Date" Width="130" Format="d"></GridColumn>
                                    <GridColumn HeaderText="AI Confidence" Width="140">
                                        <Template>
                                            @{
                                                var claim = (context as Claim)!;
                                                var confidenceClass = claim.AIConfidence >= 90 ? "high" : claim.AIConfidence >= 70 ? "medium" : "low";
                                                <span class="confidence-badge confidence-@confidenceClass">
                                                    @($"{claim.AIConfidence:F1}%")
                                                </span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(Claim.Status)" HeaderText="Status" Width="130">
                                        <Template>
                                            @{
                                                var claim = (context as Claim)!;
                                                <span class="status-badge status-@claim.Status.ToLower().Replace(" ", "-")">@claim.Status</span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn HeaderText="Actions" Width="150">
                                        <Template>
                                            <SfButton CssClass="e-small e-info" IconCss="fas fa-eye">Review</SfButton>
                                            <SfButton CssClass="e-small e-success" IconCss="fas fa-paper-plane">Submit</SfButton>
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                            </SfGrid>
                        </div>

                        <div class="ai-validation">
                            <h5><i class="fas fa-robot"></i> AI Validation Insights</h5>
                            <div class="validation-alerts">
                                @foreach (var alert in ValidationAlerts)
                                {
                                    <div class="validation-alert severity-@alert.Severity.ToLower()">
                                        <div class="alert-icon">
                                            <i class="@GetValidationIcon(alert.Severity)"></i>
                                        </div>
                                        <div class="alert-content">
                                            <div class="alert-header">
                                                <strong>@alert.ClaimId</strong> - @alert.Issue
                                            </div>
                                            <div class="alert-message">@alert.Message</div>
                                            <div class="alert-suggestion">
                                                <strong>AI Suggestion:</strong> @alert.Suggestion
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Denial Management"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="denial-panel">
                        <div class="denial-overview">
                            <h4><i class="fas fa-shield-alt"></i> Intelligent Denial Management</h4>
                            <div class="denial-metrics">
                                <div class="denial-metric-card">
                                    <div class="metric-header">
                                        <i class="fas fa-ban"></i>
                                        <span>Total Denials (MTD)</span>
                                    </div>
                                    <div class="metric-number">@DenialMetrics.TotalDenials</div>
                                    <div class="metric-amount">$@($"{DenialMetrics.TotalDenialAmount:N0}")</div>
                                </div>
                                <div class="denial-metric-card">
                                    <div class="metric-header">
                                        <i class="fas fa-undo"></i>
                                        <span>Overturn Rate</span>
                                    </div>
                                    <div class="metric-number">@($"{DenialMetrics.OverturnRate:F1}%")</div>
                                    <div class="metric-amount">$@($"{DenialMetrics.RecoveredAmount:N0}") recovered</div>
                                </div>
                                <div class="denial-metric-card">
                                    <div class="metric-header">
                                        <i class="fas fa-robot"></i>
                                        <span>AI Prevention Rate</span>
                                    </div>
                                    <div class="metric-number">@($"{DenialMetrics.PreventionRate:F1}%")</div>
                                    <div class="metric-amount">$@($"{DenialMetrics.PreventedAmount:N0}") saved</div>
                                </div>
                            </div>
                        </div>

                        <div class="denial-categories">
                            <h5><i class="fas fa-chart-bar"></i> Denial Reasons Analysis</h5>
                            <div class="categories-container">
                                <div class="category-chart">
                                    <SfChart>
                                        <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                        <ChartPrimaryYAxis Title="Number of Denials"></ChartPrimaryYAxis>
                                        <ChartSeriesCollection>
                                            <ChartSeries DataSource="@DenialReasons" XName="Reason" YName="Count" 
                                                       Type="ChartSeriesType.Column" Fill="#e74c3c">
                                            </ChartSeries>
                                        </ChartSeriesCollection>
                                    </SfChart>
                                </div>
                                <div class="category-details">
                                    @foreach (var reason in DenialReasons)
                                    {
                                        <div class="category-item">
                                            <div class="category-info">
                                                <div class="category-name">@reason.Reason</div>
                                                <div class="category-count">@reason.Count denials</div>
                                            </div>
                                            <div class="category-actions">
                                                <span class="overturn-rate">@($"{reason.OverturnRate:F0}%") overturn</span>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="denial-queue">
                            <h5><i class="fas fa-clipboard-list"></i> Active Denials Requiring Action</h5>
                            <SfGrid DataSource="@ActiveDenials" AllowSorting="true" AllowPaging="true" PageSize="8">
                                <GridColumns>
                                    <GridColumn Field="@nameof(Denial.DenialId)" HeaderText="Denial ID" Width="120"></GridColumn>
                                    <GridColumn Field="@nameof(Denial.ClaimId)" HeaderText="Claim ID" Width="120"></GridColumn>
                                    <GridColumn Field="@nameof(Denial.PatientName)" HeaderText="Patient" Width="150"></GridColumn>
                                    <GridColumn Field="@nameof(Denial.DenialReason)" HeaderText="Reason" Width="200"></GridColumn>
                                    <GridColumn Field="@nameof(Denial.Amount)" HeaderText="Amount" Width="110" Format="C0"></GridColumn>
                                    <GridColumn HeaderText="AI Win Probability" Width="160">
                                        <Template>
                                            @{
                                                var denial = (context as Denial)!;
                                                var probClass = denial.AIWinProbability >= 70 ? "high" : denial.AIWinProbability >= 40 ? "medium" : "low";
                                                <span class="probability-badge prob-@probClass">
                                                    @($"{denial.AIWinProbability:F0}%")
                                                </span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(Denial.DaysRemaining)" HeaderText="Days Left" Width="100"></GridColumn>
                                    <GridColumn HeaderText="Actions" Width="160">
                                        <Template>
                                            <SfButton CssClass="e-small e-warning" IconCss="fas fa-reply">Appeal</SfButton>
                                            <SfButton CssClass="e-small e-info" IconCss="fas fa-magic">AI Assist</SfButton>
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                            </SfGrid>
                        </div>
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="AR Management"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="ar-panel">
                        <div class="ar-overview">
                            <h4><i class="fas fa-receipt"></i> Accounts Receivable Analytics</h4>
                            <div class="ar-aging-summary">
                                <div class="aging-card current">
                                    <div class="aging-header">
                                        <i class="fas fa-calendar-day"></i>
                                        <span>0-30 Days</span>
                                    </div>
                                    <div class="aging-amount">$@($"{ARMetrics.Current:N0}")</div>
                                    <div class="aging-percent">@($"{ARMetrics.CurrentPercent:F1}%")</div>
                                </div>
                                <div class="aging-card days30">
                                    <div class="aging-header">
                                        <i class="fas fa-calendar-week"></i>
                                        <span>31-60 Days</span>
                                    </div>
                                    <div class="aging-amount">$@($"{ARMetrics.Days30:N0}")</div>
                                    <div class="aging-percent">@($"{ARMetrics.Days30Percent:F1}%")</div>
                                </div>
                                <div class="aging-card days60">
                                    <div class="aging-header">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>61-90 Days</span>
                                    </div>
                                    <div class="aging-amount">$@($"{ARMetrics.Days60:N0}")</div>
                                    <div class="aging-percent">@($"{ARMetrics.Days60Percent:F1}%")</div>
                                </div>
                                <div class="aging-card days90">
                                    <div class="aging-header">
                                        <i class="fas fa-calendar-times"></i>
                                        <span>90+ Days</span>
                                    </div>
                                    <div class="aging-amount">$@($"{ARMetrics.Days90Plus:N0}")</div>
                                    <div class="aging-percent">@($"{ARMetrics.Days90PlusPercent:F1}%")</div>
                                </div>
                            </div>
                        </div>

                        <div class="ar-chart">
                            <h5><i class="fas fa-chart-line"></i> AR Aging Trend</h5>
                            <SfChart>
                                <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                <ChartPrimaryYAxis Title="Amount ($)"></ChartPrimaryYAxis>
                                <ChartSeriesCollection>
                                    <ChartSeries DataSource="@ARTrend" XName="Month" YName="Current" 
                                               Name="0-30 Days" Type="ChartSeriesType.StackingColumn" Fill="#27ae60">
                                    </ChartSeries>
                                    <ChartSeries DataSource="@ARTrend" XName="Month" YName="Days30" 
                                               Name="31-60 Days" Type="ChartSeriesType.StackingColumn" Fill="#f39c12">
                                    </ChartSeries>
                                    <ChartSeries DataSource="@ARTrend" XName="Month" YName="Days60" 
                                               Name="61-90 Days" Type="ChartSeriesType.StackingColumn" Fill="#e67e22">
                                    </ChartSeries>
                                    <ChartSeries DataSource="@ARTrend" XName="Month" YName="Days90Plus" 
                                               Name="90+ Days" Type="ChartSeriesType.StackingColumn" Fill="#e74c3c">
                                    </ChartSeries>
                                </ChartSeriesCollection>
                            </SfChart>
                        </div>

                        <div class="ar-worklist">
                            <h5><i class="fas fa-tasks"></i> AI-Prioritized AR Worklist</h5>
                            <SfGrid DataSource="@ARWorklist" AllowSorting="true" AllowPaging="true" PageSize="10">
                                <GridColumns>
                                    <GridColumn Field="@nameof(ARItem.AccountId)" HeaderText="Account ID" Width="130"></GridColumn>
                                    <GridColumn Field="@nameof(ARItem.PatientName)" HeaderText="Patient" Width="150"></GridColumn>
                                    <GridColumn Field="@nameof(ARItem.Payer)" HeaderText="Payer" Width="140"></GridColumn>
                                    <GridColumn Field="@nameof(ARItem.Balance)" HeaderText="Balance" Width="120" Format="C0"></GridColumn>
                                    <GridColumn Field="@nameof(ARItem.DaysOutstanding)" HeaderText="Days Out" Width="100"></GridColumn>
                                    <GridColumn HeaderText="Collection Probability" Width="170">
                                        <Template>
                                            @{
                                                var item = (context as ARItem)!;
                                                var probClass = item.CollectionProbability >= 70 ? "high" : item.CollectionProbability >= 40 ? "medium" : "low";
                                                <span class="collection-prob prob-@probClass">
                                                    @($"{item.CollectionProbability:F0}%")
                                                </span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="@nameof(ARItem.AIPriority)" HeaderText="AI Priority" Width="120">
                                        <Template>
                                            @{
                                                var item = (context as ARItem)!;
                                                <span class="priority-badge priority-@item.AIPriority.ToLower()">@item.AIPriority</span>
                                            }
                                        </Template>
                                    </GridColumn>
                                    <GridColumn HeaderText="Actions" Width="140">
                                        <Template>
                                            <SfButton CssClass="e-small e-primary" IconCss="fas fa-phone">Contact</SfButton>
                                            <SfButton CssClass="e-small e-info" IconCss="fas fa-file-invoice">Bill</SfButton>
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                            </SfGrid>
                        </div>
                    </div>
                </ContentTemplate>
            </TabItem>

            <TabItem>
                <ChildContent>
                    <TabHeader Text="Predictive Analytics"></TabHeader>
                </ChildContent>
                <ContentTemplate>
                    <div class="predictive-panel">
                        <div class="predictions-header">
                            <h4><i class="fas fa-brain"></i> AI Revenue Predictions & Insights</h4>
                            <p>Machine learning models trained on 7 years of financial data with 93.5% accuracy</p>
                        </div>

                        <div class="revenue-forecast">
                            <h5><i class="fas fa-chart-line"></i> 90-Day Revenue Forecast</h5>
                            <div class="forecast-summary">
                                <div class="forecast-card">
                                    <i class="fas fa-calendar-day"></i>
                                    <div>
                                        <div class="forecast-label">Next 30 Days</div>
                                        <div class="forecast-value">$@($"{RevenuePredictions.Next30Days:N0}")</div>
                                        <div class="forecast-confidence">Confidence: 95.2%</div>
                                    </div>
                                </div>
                                <div class="forecast-card">
                                    <i class="fas fa-calendar-week"></i>
                                    <div>
                                        <div class="forecast-label">Next 60 Days</div>
                                        <div class="forecast-value">$@($"{RevenuePredictions.Next60Days:N0}")</div>
                                        <div class="forecast-confidence">Confidence: 91.8%</div>
                                    </div>
                                </div>
                                <div class="forecast-card">
                                    <i class="fas fa-calendar"></i>
                                    <div>
                                        <div class="forecast-label">Next 90 Days</div>
                                        <div class="forecast-value">$@($"{RevenuePredictions.Next90Days:N0}")</div>
                                        <div class="forecast-confidence">Confidence: 88.4%</div>
                                    </div>
                                </div>
                            </div>

                            <div class="forecast-chart">
                                <SfChart>
                                    <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.Category"></ChartPrimaryXAxis>
                                    <ChartPrimaryYAxis Title="Revenue ($)"></ChartPrimaryYAxis>
                                    <ChartSeriesCollection>
                                        <ChartSeries DataSource="@ForecastData" XName="Period" YName="Actual" 
                                                   Name="Actual" Type="ChartSeriesType.Line" Fill="#3498db">
                                            <ChartMarker Visible="true"></ChartMarker>
                                        </ChartSeries>
                                        <ChartSeries DataSource="@ForecastData" XName="Period" YName="Predicted" 
                                                   Name="Predicted" Type="ChartSeriesType.Line" Fill="#e74c3c" DashArray="5,5">
                                            <ChartMarker Visible="true"></ChartMarker>
                                        </ChartSeries>
                                    </ChartSeriesCollection>
                                </SfChart>
                            </div>
                        </div>

                        <div class="risk-analysis">
                            <h5><i class="fas fa-exclamation-triangle"></i> Financial Risk Analysis</h5>
                            <div class="risk-items">
                                @foreach (var risk in FinancialRisks)
                                {
                                    <div class="risk-card risk-@risk.Severity.ToLower()">
                                        <div class="risk-header">
                                            <div class="risk-title">
                                                <i class="@GetRiskIcon(risk.Severity)"></i>
                                                @risk.Title
                                            </div>
                                            <span class="risk-badge risk-@risk.Severity.ToLower()">@risk.Severity Risk</span>
                                        </div>
                                        <div class="risk-description">@risk.Description</div>
                                        <div class="risk-impact">
                                            <strong>Potential Impact:</strong> $@($"{risk.PotentialImpact:N0}")
                                        </div>
                                        <div class="risk-mitigation">
                                            <strong>AI Recommendation:</strong> @risk.Mitigation
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="optimization-recommendations">
                            <h5><i class="fas fa-lightbulb"></i> AI Revenue Optimization Recommendations</h5>
                            <div class="recommendations-list">
                                @foreach (var rec in OptimizationRecommendations)
                                {
                                    <div class="recommendation-card">
                                        <div class="rec-icon">
                                            <i class="@rec.Icon"></i>
                                        </div>
                                        <div class="rec-content">
                                            <div class="rec-title">@rec.Title</div>
                                            <div class="rec-description">@rec.Description</div>
                                            <div class="rec-metrics">
                                                <div class="rec-metric">
                                                    <label>Projected Impact:</label>
                                                    <span class="impact-value">$@($"{rec.ProjectedImpact:N0}")/year</span>
                                                </div>
                                                <div class="rec-metric">
                                                    <label>Implementation Effort:</label>
                                                    <span class="effort-@rec.Effort.ToLower()">@rec.Effort</span>
                                                </div>
                                                <div class="rec-metric">
                                                    <label>Timeline:</label>
                                                    <span>@rec.Timeline</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="rec-actions">
                                            <SfButton CssClass="e-success" IconCss="fas fa-check">Implement</SfButton>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </ContentTemplate>
            </TabItem>
        </TabItems>
    </SfTab>
</div>

<style>
    .n360-revenue-cycle {
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .revenue-header {
        margin-bottom: 30px;
    }

    .revenue-header h3 {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 8px;
    }

    .revenue-header h3 i {
        color: #27ae60;
        margin-right: 10px;
    }

    .revenue-subtitle {
        color: #7f8c8d;
        font-size: 14px;
        margin: 0;
    }

    .revenue-tabs {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .dashboard-panel, .claims-panel, .denial-panel, .ar-panel, .predictive-panel {
        padding: 20px;
    }

    .financial-overview {
        margin-bottom: 30px;
    }

    .financial-overview h4 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    .metric-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        gap: 15px;
    }

    .metric-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: white;
    }

    .metric-card.revenue .metric-icon {
        background: linear-gradient(135deg, #27ae60, #229954);
    }

    .metric-card.collection .metric-icon {
        background: linear-gradient(135deg, #3498db, #2980b9);
    }

    .metric-card.ar .metric-icon {
        background: linear-gradient(135deg, #f39c12, #e67e22);
    }

    .metric-card.denial .metric-icon {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .metric-card.clean-claim .metric-icon {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
    }

    .metric-card.net-collection .metric-icon {
        background: linear-gradient(135deg, #16a085, #138d75);
    }

    .metric-content {
        flex: 1;
    }

    .metric-label {
        font-size: 13px;
        color: #7f8c8d;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .metric-value {
        font-size: 28px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 8px;
    }

    .metric-trend {
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .metric-trend i {
        margin-right: 4px;
    }

    .metric-trend.trend-up {
        color: #27ae60;
    }

    .metric-trend.trend-down {
        color: #e74c3c;
    }

    .metric-progress {
        margin-top: 12px;
    }

    .revenue-charts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    .chart-container {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .chart-container h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .claims-overview {
        margin-bottom: 30px;
    }

    .claims-overview h4 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .claims-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .stat-card i {
        font-size: 36px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 13px;
        opacity: 0.95;
    }

    .claims-queue, .ai-validation {
        margin-top: 30px;
    }

    .claims-queue h5, .ai-validation h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .confidence-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .confidence-badge.confidence-high {
        background: #27ae60;
    }

    .confidence-badge.confidence-medium {
        background: #f39c12;
    }

    .confidence-badge.confidence-low {
        background: #e74c3c;
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .status-badge.status-approved {
        background: #27ae60;
    }

    .status-badge.status-pending-review {
        background: #f39c12;
    }

    .status-badge.status-processing {
        background: #3498db;
    }

    .status-badge.status-flagged {
        background: #e74c3c;
    }

    .validation-alerts {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .validation-alert {
        background: white;
        border-left: 4px solid;
        border-radius: 8px;
        padding: 15px 20px;
        display: flex;
        gap: 15px;
    }

    .validation-alert.severity-error {
        border-left-color: #e74c3c;
        background: #ffebee;
    }

    .validation-alert.severity-warning {
        border-left-color: #f39c12;
        background: #fff8e1;
    }

    .alert-icon {
        font-size: 24px;
    }

    .validation-alert.severity-error .alert-icon {
        color: #e74c3c;
    }

    .validation-alert.severity-warning .alert-icon {
        color: #f39c12;
    }

    .alert-content {
        flex: 1;
    }

    .alert-header {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
    }

    .alert-message {
        font-size: 14px;
        color: #34495e;
        margin-bottom: 10px;
    }

    .alert-suggestion {
        padding: 10px;
        background: rgba(46, 213, 115, 0.1);
        border-radius: 6px;
        font-size: 13px;
        color: #2c3e50;
    }

    .denial-overview {
        margin-bottom: 30px;
    }

    .denial-overview h4 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .denial-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .denial-metric-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 25px;
        text-align: center;
    }

    .metric-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 15px;
        color: #7f8c8d;
        font-size: 14px;
        font-weight: 600;
    }

    .metric-header i {
        font-size: 20px;
    }

    .metric-number {
        font-size: 36px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .metric-amount {
        font-size: 14px;
        color: #27ae60;
        font-weight: 600;
    }

    .denial-categories {
        margin-bottom: 30px;
    }

    .denial-categories h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .categories-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    .category-chart {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .category-details {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .category-item {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .category-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .category-count {
        font-size: 13px;
        color: #7f8c8d;
    }

    .overturn-rate {
        padding: 5px 12px;
        background: #27ae60;
        color: white;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .denial-queue {
        margin-top: 30px;
    }

    .denial-queue h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .probability-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .probability-badge.prob-high {
        background: #27ae60;
    }

    .probability-badge.prob-medium {
        background: #f39c12;
    }

    .probability-badge.prob-low {
        background: #e74c3c;
    }

    .ar-overview {
        margin-bottom: 30px;
    }

    .ar-overview h4 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .ar-aging-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .aging-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }

    .aging-card.current {
        border-top: 4px solid #27ae60;
    }

    .aging-card.days30 {
        border-top: 4px solid #f39c12;
    }

    .aging-card.days60 {
        border-top: 4px solid #e67e22;
    }

    .aging-card.days90 {
        border-top: 4px solid #e74c3c;
    }

    .aging-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 15px;
        color: #7f8c8d;
        font-size: 13px;
        font-weight: 600;
    }

    .aging-header i {
        font-size: 18px;
    }

    .aging-amount {
        font-size: 28px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .aging-percent {
        font-size: 14px;
        color: #7f8c8d;
    }

    .ar-chart, .ar-worklist {
        margin-top: 30px;
    }

    .ar-chart h5, .ar-worklist h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .collection-prob {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .collection-prob.prob-high {
        background: #27ae60;
    }

    .collection-prob.prob-medium {
        background: #f39c12;
    }

    .collection-prob.prob-low {
        background: #e74c3c;
    }

    .priority-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .priority-badge.priority-urgent {
        background: #e74c3c;
    }

    .priority-badge.priority-high {
        background: #f39c12;
    }

    .priority-badge.priority-medium {
        background: #3498db;
    }

    .priority-badge.priority-low {
        background: #95a5a6;
    }

    .predictions-header {
        margin-bottom: 30px;
    }

    .predictions-header h4 {
        margin: 0 0 8px 0;
        color: #2c3e50;
        font-size: 18px;
    }

    .predictions-header p {
        margin: 0;
        color: #7f8c8d;
        font-size: 14px;
    }

    .revenue-forecast {
        margin-bottom: 40px;
    }

    .revenue-forecast h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .forecast-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .forecast-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .forecast-card i {
        font-size: 36px;
    }

    .forecast-label {
        font-size: 13px;
        opacity: 0.95;
        margin-bottom: 8px;
    }

    .forecast-value {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .forecast-confidence {
        font-size: 12px;
        opacity: 0.85;
    }

    .forecast-chart {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
    }

    .risk-analysis {
        margin-bottom: 40px;
    }

    .risk-analysis h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .risk-items {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .risk-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-left-width: 4px;
        border-radius: 8px;
        padding: 20px;
    }

    .risk-card.risk-high {
        border-left-color: #e74c3c;
    }

    .risk-card.risk-medium {
        border-left-color: #f39c12;
    }

    .risk-card.risk-low {
        border-left-color: #3498db;
    }

    .risk-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .risk-title {
        font-weight: 600;
        color: #2c3e50;
        font-size: 16px;
    }

    .risk-title i {
        margin-right: 8px;
        color: #e74c3c;
    }

    .risk-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        color: white;
    }

    .risk-badge.risk-high {
        background: #e74c3c;
    }

    .risk-badge.risk-medium {
        background: #f39c12;
    }

    .risk-badge.risk-low {
        background: #3498db;
    }

    .risk-description {
        color: #34495e;
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 12px;
    }

    .risk-impact {
        padding: 10px;
        background: #ffebee;
        border-radius: 6px;
        font-size: 13px;
        color: #2c3e50;
        margin-bottom: 12px;
    }

    .risk-mitigation {
        padding: 10px;
        background: #e8f5e9;
        border-radius: 6px;
        font-size: 13px;
        color: #2c3e50;
    }

    .optimization-recommendations h5 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 16px;
    }

    .recommendations-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .recommendation-card {
        background: white;
        border: 2px solid #ecf0f1;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        gap: 20px;
    }

    .rec-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
    }

    .rec-content {
        flex: 1;
    }

    .rec-title {
        font-weight: 600;
        color: #2c3e50;
        font-size: 16px;
        margin-bottom: 10px;
    }

    .rec-description {
        color: #34495e;
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 15px;
    }

    .rec-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    .rec-metric {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .rec-metric label {
        font-size: 12px;
        color: #7f8c8d;
        font-weight: 600;
    }

    .rec-metric span {
        font-size: 14px;
        color: #2c3e50;
        font-weight: 600;
    }

    .impact-value {
        color: #27ae60 !important;
        font-size: 16px !important;
    }

    .effort-low {
        color: #27ae60 !important;
    }

    .effort-medium {
        color: #f39c12 !important;
    }

    .effort-high {
        color: #e74c3c !important;
    }

    .rec-actions {
        display: flex;
        align-items: center;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .alert-warning {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
    }
</style>
